<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Simple - Mobile Plans</title>
    
    <style>
        /* Estilos m√≠nimos para probar */
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        
        .section {
            margin: 20px 0;
            padding: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }
        
        .nav-button {
            background: white;
            color: #333;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .nav-button:hover {
            background: #f0f0f0;
        }
        
        .content-area {
            margin: 20px 0;
            padding: 20px;
            background: rgba(255,255,255,0.2);
            border-radius: 8px;
            min-height: 200px;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <h1>Test Simple Mobile Plans</h1>
    <p>P√°gina de prueba para verificar comunicaci√≥n iframe sin dependencias</p>
    
    <!-- Navegaci√≥n simple -->
    <div class="section">
        <h2>Navegaci√≥n de Prueba</h2>
        <button class="nav-button" onclick="showSection('home')">Inicio</button>
        <button class="nav-button" onclick="showSection('plans')">Planes</button>
        <button class="nav-button" onclick="showSection('compare')">Comparar</button>
        <button class="nav-button" onclick="addContent()">Agregar Contenido</button>
        <button class="nav-button" onclick="removeContent()">Quitar Contenido</button>
    </div>
    
    <!-- Secciones de contenido -->
    <div id="home" class="content-area">
        <h3>Secci√≥n de Inicio</h3>
        <p>Esta es la p√°gina de inicio. Contenido b√°sico para probar el tama√±o.</p>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore.</p>
    </div>
    
    <div id="plans" class="content-area hidden">
        <h3>Secci√≥n de Planes</h3>
        <p>Aqu√≠ est√°n todos los planes m√≥viles disponibles.</p>
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin: 20px 0;">
            <div style="background: rgba(255,255,255,0.3); padding: 15px; border-radius: 8px;">
                <h4>Plan B√°sico</h4>
                <p>10GB - 15‚Ç¨/mes</p>
            </div>
            <div style="background: rgba(255,255,255,0.3); padding: 15px; border-radius: 8px;">
                <h4>Plan Premium</h4>
                <p>50GB - 35‚Ç¨/mes</p>
            </div>
            <div style="background: rgba(255,255,255,0.3); padding: 15px; border-radius: 8px;">
                <h4>Plan Ilimitado</h4>
                <p>Datos ilimitados - 50‚Ç¨/mes</p>
            </div>
            <div style="background: rgba(255,255,255,0.3); padding: 15px; border-radius: 8px;">
                <h4>Plan Joven</h4>
                <p>25GB - 20‚Ç¨/mes</p>
            </div>
        </div>
    </div>
    
    <div id="compare" class="content-area hidden">
        <h3>Secci√≥n de Comparaci√≥n</h3>
        <p>Compara diferentes planes m√≥viles lado a lado.</p>
        <table style="width: 100%; background: rgba(255,255,255,0.2); border-radius: 8px; padding: 15px; border-collapse: collapse;">
            <thead>
                <tr style="background: rgba(255,255,255,0.3);">
                    <th style="padding: 10px; text-align: left;">Caracter√≠stica</th>
                    <th style="padding: 10px; text-align: center;">Plan A</th>
                    <th style="padding: 10px; text-align: center;">Plan B</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td style="padding: 8px;">Datos</td>
                    <td style="padding: 8px; text-align: center;">10GB</td>
                    <td style="padding: 8px; text-align: center;">25GB</td>
                </tr>
                <tr>
                    <td style="padding: 8px;">Precio</td>
                    <td style="padding: 8px; text-align: center;">15‚Ç¨</td>
                    <td style="padding: 8px; text-align: center;">25‚Ç¨</td>
                </tr>
            </tbody>
        </table>
    </div>
    
    <div id="dynamic-content" style="margin: 20px 0;">
        <!-- Contenido que se agrega/quita din√°micamente -->
    </div>
    
    <div class="section">
        <p><strong>Estado:</strong> <span id="status">P√°gina cargada</span></p>
        <p><strong>Altura actual:</strong> <span id="current-height">-</span>px</p>
        <p><strong>√öltima comunicaci√≥n:</strong> <span id="last-communication">-</span></p>
    </div>

    <script>
        // Variables globales
        let currentSection = 'home';
        let dynamicContentCount = 0;
        
        // Funci√≥n para mostrar secciones
        function showSection(sectionName) {
            // Ocultar todas las secciones
            document.getElementById('home').classList.add('hidden');
            document.getElementById('plans').classList.add('hidden'); 
            document.getElementById('compare').classList.add('hidden');
            
            // Mostrar la secci√≥n seleccionada
            document.getElementById(sectionName).classList.remove('hidden');
            currentSection = sectionName;
            
            updateStatus('Navegando a: ' + sectionName);
            console.log('üìÑ Navegando a secci√≥n:', sectionName);
            
            // Esperar un poco para que se complete el cambio
            setTimeout(() => {
                if (window.self !== window.top) {
                    enviarAltura();
                }
            }, 100);
        }
        
        // Funci√≥n para agregar contenido din√°mico
        function addContent() {
            dynamicContentCount++;
            const content = document.createElement('div');
            content.style.cssText = 'margin: 10px 0; padding: 15px; background: rgba(255,255,255,0.2); border-radius: 8px;';
            content.innerHTML = `
                <h4>Contenido Din√°mico #${dynamicContentCount}</h4>
                <p>Este es contenido agregado din√°micamente para probar el cambio de altura del iframe.</p>
                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
            `;
            
            document.getElementById('dynamic-content').appendChild(content);
            updateStatus('Contenido agregado (#' + dynamicContentCount + ')');
            
            setTimeout(() => {
                if (window.self !== window.top) {
                    enviarAltura();
                }
            }, 100);
        }
        
        // Funci√≥n para quitar contenido din√°mico
        function removeContent() {
            const dynamicContainer = document.getElementById('dynamic-content');
            if (dynamicContainer.children.length > 0) {
                dynamicContainer.removeChild(dynamicContainer.lastElementChild);
                dynamicContentCount = Math.max(0, dynamicContentCount - 1);
                updateStatus('Contenido removido (quedan ' + dynamicContentCount + ')');
                
                setTimeout(() => {
                    if (window.self !== window.top) {
                        enviarAltura();
                    }
                }, 100);
            }
        }
        
        // Funci√≥n para actualizar status
        function updateStatus(message) {
            document.getElementById('status').textContent = message;
            document.getElementById('last-communication').textContent = new Date().toLocaleTimeString();
        }
        
        // ============ COMUNICACI√ìN IFRAME - EXACTA DEL EJEMPLO ============
        if (window.self !== window.top) {
            console.log('üì± Test Simple: Detectado iframe - configurando comunicaci√≥n...');
            
            function calcularAlturaContenido() {
                try {
                    const body = document.body;
                    const html = document.documentElement;
                    
                    // M√©todo defensivo - verificar que las propiedades existen
                    const alturas = [];
                    
                    if (body && typeof body.scrollHeight === 'number') {
                        alturas.push(body.scrollHeight);
                    }
                    
                    if (body && typeof body.offsetHeight === 'number') {
                        alturas.push(body.offsetHeight);
                    }
                    
                    if (html && typeof html.scrollHeight === 'number') {
                        alturas.push(html.scrollHeight);
                    }
                    
                    if (html && typeof html.offsetHeight === 'number') {
                        alturas.push(html.offsetHeight);
                    }
                    
                    // Si no tenemos alturas v√°lidas, usar un valor por defecto
                    if (alturas.length === 0) {
                        console.warn('‚ö†Ô∏è Test Simple: No se pudieron obtener alturas, usando valor estimado');
                        return 600; // Valor por defecto razonable
                    }
                    
                    const alturaMaxima = Math.max(...alturas);
                    
                    // Log detallado para debug del crecimiento
                    console.log('üìê Test Simple: Alturas calculadas DETALLADO:', {
                        bodyScroll: body?.scrollHeight,
                        bodyOffset: body?.offsetHeight,
                        htmlScroll: html?.scrollHeight,
                        htmlOffset: html?.offsetHeight,
                        alturasArray: alturas,
                        resultado: alturaMaxima,
                        ultimaEnviada: ultimaAlturaEnviada,
                        diferencia: Math.abs(alturaMaxima - ultimaAlturaEnviada),
                        timestamp: new Date().toLocaleTimeString()
                    });
                    
                    // Verificar si hay algo extra√±o
                    if (alturaMaxima > ultimaAlturaEnviada + 50) {
                        console.warn('üö® Test Simple: CRECIMIENTO AN√ìMALO DETECTADO!', {
                            anterior: ultimaAlturaEnviada,
                            actual: alturaMaxima,
                            incremento: alturaMaxima - ultimaAlturaEnviada,
                            bodyStyle: body.style.cssText,
                            htmlStyle: html.style.cssText
                        });
                    }
                    
                    return alturaMaxima;
                    
                } catch (error) {
                    console.error('‚ùå Test Simple: Error calculando altura:', error);
                    return 600; // Valor por defecto en caso de error
                }
            }
            
            let ultimaAlturaEnviada = 0;
            const TOLERANCIA_ALTURA = 5; // Solo enviar si cambia m√°s de 5px
            
            function enviarAltura() {
                const altura = calcularAlturaContenido();
                document.getElementById('current-height').textContent = altura;
                
                // Solo enviar si hay cambio significativo
                const diferencia = Math.abs(altura - ultimaAlturaEnviada);
                
                if (diferencia > TOLERANCIA_ALTURA || ultimaAlturaEnviada === 0) {
                    if (window.parent) {
                        window.parent.postMessage({
                            tipo: 'ajustarAltura',
                            altura: altura
                        }, '*');
                        
                        ultimaAlturaEnviada = altura;
                        updateStatus('Altura enviada: ' + altura + 'px (cambio: ' + diferencia + 'px)');
                        console.log('üì° Test Simple: Altura enviada:', altura + 'px', '(diferencia: ' + diferencia + 'px)');
                    }
                } else {
                    updateStatus('Altura estable: ' + altura + 'px (sin cambios)');
                    console.log('üìè Test Simple: Altura estable, no enviando:', altura + 'px');
                }
            }
            
            // Escuchar solicitudes del padre
            window.addEventListener('message', function(e) {
                if (typeof e.data === 'object' && e.data.tipo === 'solicitarAltura') {
                    console.log('üì° Test Simple: Solicitud recibida');
                    enviarAltura();
                }
            });
            
            // Env√≠o inicial
            setTimeout(() => {
                enviarAltura();
                updateStatus('Comunicaci√≥n iframe inicializada');
            }, 500);
            
            console.log('‚úÖ Test Simple: Comunicaci√≥n configurada');
        } else {
            console.log('üì± Test Simple: Ejecut√°ndose standalone');
            updateStatus('Modo standalone (sin iframe)');
            
            // En modo standalone, mostrar altura en tiempo real
            setInterval(() => {
                const altura = Math.max(
                    document.body.scrollHeight,
                    document.body.offsetHeight,
                    document.documentElement.scrollHeight,
                    document.documentElement.offsetHeight
                );
                document.getElementById('current-height').textContent = altura;
            }, 1000);
        }
    </script>
</body>
</html>